name: ðŸ“ Auto Update Documentation

on:
  push:
    branches: 
      - main
      - master
      - test-*                  # Cho phÃ©p test trÃªn branch test-*
      - feature/*               # Hoáº·c branch feature/*
    paths:
      - 'Solutions/**'          # Chá»‰ cháº¡y khi cÃ³ thay Ä‘á»•i trong Solutions
  pull_request:
    branches: [ main, master ]
    paths:
      - 'Solutions/**'
  workflow_dispatch:            # Cho phÃ©p cháº¡y manual

jobs:
  update-documentation:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ›’ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ðŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: ðŸ“Š Show Repository Structure
      run: |
        echo "ðŸ“ Repository structure:"
        echo "Root files:"
        ls -la
        echo ""
        echo "Scripts folder:"
        ls -la Scripts/ 2>/dev/null || echo "Scripts folder not found"
        echo ""
        echo "Docs folder:"
        ls -la Docs/ 2>/dev/null || echo "Docs folder not found" 
        echo ""
        echo "Solutions structure (first 10):"
        find Solutions -type d 2>/dev/null | head -10 || echo "Solutions folder not found"
        
    - name: ðŸ”„ Run Documentation Update Script
      run: |
        echo "ðŸš€ Running Scripts/update_progress.py..."
        python Scripts/update_progress.py
        
    - name: ðŸ“‹ Check for Changes
      id: check_changes
      run: |
        git status
        if [ -n "$(git status --porcelain)" ]; then
          echo "changes=true" >> $GITHUB_OUTPUT
          echo "ðŸ“ Changes detected in:"
          git status --short
          echo ""
          echo "ðŸ“„ Modified files:"
          git diff --name-only
        else
          echo "changes=false" >> $GITHUB_OUTPUT
          echo "â„¹ï¸ No changes detected"
        fi
        
    - name: âš™ï¸ Configure Git
      if: steps.check_changes.outputs.changes == 'true'
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
    - name: ðŸ“ Commit and Push Changes
      if: steps.check_changes.outputs.changes == 'true'
      run: |
        echo "ðŸ“¤ Committing changes..."
        git add Docs/*.md
        
        # Táº¡o commit message vá»›i thÃ´ng tin chi tiáº¿t
        CHANGED_FILES=$(git diff --cached --name-only)
        BRANCH_NAME=${GITHUB_REF#refs/heads/}
        
        if [[ "$BRANCH_NAME" == "main" || "$BRANCH_NAME" == "master" ]]; then
          COMMIT_PREFIX="ðŸ“ Auto-update documentation"
        else
          COMMIT_PREFIX="ðŸ§ª [TEST] Auto-update documentation"
        fi
        
        echo "Changed files: $CHANGED_FILES"
        
        git commit -m "$COMMIT_PREFIX

ðŸ“Š Updated documentation files:
$CHANGED_FILES

ðŸ”§ Details:
- Branch: $BRANCH_NAME
- Script: Scripts/update_progress.py  
- Trigger: ${{ github.event_name }}
- Commit: $(echo ${{ github.sha }} | cut -c1-8)

[skip ci]"
        
        # Push vÃ o cÃ¹ng branch Ä‘ang lÃ m viá»‡c
        git push origin HEAD:$BRANCH_NAME
        
    - name: ðŸ“Š Summary
      run: |
        echo "## ðŸ“Š Documentation Update Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if [ "${{ steps.check_changes.outputs.changes }}" == "true" ]; then
          echo "âœ… **Documentation updated successfully!**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“ Files Updated:" >> $GITHUB_STEP_SUMMARY
          git show --name-only --pretty="" HEAD | sed 's/^/- /' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”§ Details:" >> $GITHUB_STEP_SUMMARY
          echo "- **Script:** Scripts/update_progress.py" >> $GITHUB_STEP_SUMMARY
          echo "- **Branch:** ${GITHUB_REF#refs/heads/}" >> $GITHUB_STEP_SUMMARY
          echo "- **Trigger:** ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
        else
          echo "â„¹ï¸ **No updates needed** - documentation is already up to date!" >> $GITHUB_STEP_SUMMARY
        fi