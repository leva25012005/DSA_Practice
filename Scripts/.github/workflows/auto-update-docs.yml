name: ðŸ“ Auto Update Documentation

on:
  push:
    branches: 
      - main
      - master
      - test-*                  # Cho phÃ©p test trÃªn branch test-*
      - feature/*               # Hoáº·c branch feature/*
    paths:
      - 'Solutions/**'          # Chá»‰ cháº¡y khi cÃ³ thay Ä‘á»•i trong Solutions
  pull_request:
    branches: [ main, master ]
    paths:
      - 'Solutions/**'
  workflow_dispatch:            # Cho phÃ©p cháº¡y manual

jobs:
  update-documentation:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ›’ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0          # Láº¥y full history
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ðŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: ðŸ“Š Show Repository Structure
      run: |
        echo "ðŸ“ Repository structure:"
        find . -type f -name "*.py" | head -10
        find Solutions -type d 2>/dev/null | head -10 || echo "Solutions folder not found"
        ls -la Docs/ 2>/dev/null || echo "Docs folder not found"
        
    - name: ðŸ”„ Run Documentation Update Script
      run: |
        echo "ðŸš€ Running update_docs.py..."
        python update_docs.py
        
    - name: ðŸ“‹ Check for Changes
      id: check_changes
      run: |
        if [ -n "$(git status --porcelain)" ]; then
          echo "changes=true" >> $GITHUB_OUTPUT
          echo "ðŸ“ Changes detected:"
          git status --short
        else
          echo "changes=false" >> $GITHUB_OUTPUT
          echo "â„¹ï¸ No changes detected"
        fi
        
    - name: âš™ï¸ Configure Git
      if: steps.check_changes.outputs.changes == 'true'
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
    - name: ðŸ“ Commit and Push Changes
      if: steps.check_changes.outputs.changes == 'true'
      run: |
        echo "ðŸ“¤ Committing changes..."
        git add Docs/*.md
        
        # Táº¡o commit message vá»›i thÃ´ng tin chi tiáº¿t
        CHANGED_FILES=$(git diff --cached --name-only | wc -l)
        BRANCH_NAME=${GITHUB_REF#refs/heads/}
        
        if [[ "$BRANCH_NAME" == "main" || "$BRANCH_NAME" == "master" ]]; then
          COMMIT_PREFIX="ðŸ“ Auto-update documentation"
        else
          COMMIT_PREFIX="ðŸ§ª [TEST] Auto-update documentation"
        fi
        
        COMMIT_MSG="$COMMIT_PREFIX
        
        - Updated $CHANGED_FILES file(s)
        - Branch: $BRANCH_NAME
        - Triggered by: ${{ github.event_name }}
        - Commit: ${{ github.sha }}
        
        [skip ci]"
        
        git commit -m "$COMMIT_MSG"
        
        # Push vÃ o cÃ¹ng branch Ä‘ang lÃ m viá»‡c
        git push origin HEAD:$BRANCH_NAME
        
    - name: ðŸ“Š Summary
      run: |
        echo "## ðŸ“Š Update Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        if [ "${{ steps.check_changes.outputs.changes }}" == "true" ]; then
          echo "âœ… Documentation updated successfully!" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“ Files updated:" >> $GITHUB_STEP_SUMMARY
          git show --name-only --pretty="" HEAD | sed 's/^/- /' >> $GITHUB_STEP_SUMMARY
        else
          echo "â„¹ï¸ No updates needed - documentation is up to date!" >> $GITHUB_STEP_SUMMARY
        fi